# ===============================================================================
# TSN Switch 1 Configuration
# ===============================================================================

# SWITCH 1

# enable egress traffic shaping
*.tsnSwitch.hasEgressTrafficShaping = true

# disable forwarding IEEE 802.1Q C-Tag
*.tsnSwitch.bridging.directionReverser.reverser.excludeEncapsulationProtocols = ["ieee8021qctag"]


# time-aware traffic shaping
*.tsnSwitch.eth[*].macLayer.queue.numTrafficClasses = 8

*.tsnSwitch.eth[*].macLayer.queue.*[7].display-name = "critical-priority"
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[7].offset = 0ms
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[7].durations = [9ms, 3ms] # period is 10 [open, close]

*.tsnSwitch.eth[*].macLayer.queue.*[5].display-name = "medium-priority"
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[5].offset = 3ms
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[5].durations = [2ms, 10ms] # [open, close]

*.tsnSwitch.eth[*].macLayer.queue.*[1].display-name = "best-effort-priority"
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[1].offset = 1ms
*.tsnSwitch.eth[*].macLayer.queue.transmissionGate[1].durations = [1ms, 11ms] # [open, close]

# gPTP
*.tsnSwitch.gptp.slavePort = "eth2"
*.tsnSwitch.gptp.masterPorts = ["eth1","eth0","eth3"]

# Per-Stream Filtering

*.tsnSwitch.hasIngressTrafficFiltering = true

*.tsnSwitch.bridging.streamFilter.ingress.numStreams = 6
*.tsnSwitch.bridging.streamFilter.ingress.classifier.mapping = {"download data": 0, "radar/distance data": 1, "tire pressure data": 2, "lane/distance data": 3, "speed/torque command": 4, "brake command": 5}
*.tsnSwitch.bridging.streamFilter.ingress.meter[0].display-name = "download data"
*.tsnSwitch.bridging.streamFilter.ingress.meter[1].display-name = "radar/distance data"
*.tsnSwitch.bridging.streamFilter.ingress.meter[2].display-name = "tire pressure data"
*.tsnSwitch.bridging.streamFilter.ingress.meter[3].display-name = "lane/distance data"
*.tsnSwitch.bridging.streamFilter.ingress.meter[4].display-name = "speed/torque command"
*.tsnSwitch.bridging.streamFilter.ingress.meter[5].display-name = "brake command"

*.tsnSwitch.bridging.streamFilter.ingress.meter[*].typename = "SingleRateTwoColorMeter"

*.tsnSwitch.bridging.streamFilter.ingress.meter[0].committedInformationRate = 40Mbps
*.tsnSwitch.bridging.streamFilter.ingress.meter[1].committedInformationRate = 20Mbps
*.tsnSwitch.bridging.streamFilter.ingress.meter[2].committedInformationRate = 40Mbps
*.tsnSwitch.bridging.streamFilter.ingress.meter[3].committedInformationRate = 20Mbps
*.tsnSwitch.bridging.streamFilter.ingress.meter[4].committedInformationRate = 40Mbps
*.tsnSwitch.bridging.streamFilter.ingress.meter[5].committedInformationRate = 20Mbps

*.tsnSwitch.bridging.streamFilter.ingress.meter[0].committedBurstSize = 10kB
*.tsnSwitch.bridging.streamFilter.ingress.meter[1].committedBurstSize = 5kB
*.tsnSwitch.bridging.streamFilter.ingress.meter[2].committedBurstSize = 10kB
*.tsnSwitch.bridging.streamFilter.ingress.meter[3].committedBurstSize = 5kB
*.tsnSwitch.bridging.streamFilter.ingress.meter[4].committedBurstSize = 10kB
*.tsnSwitch.bridging.streamFilter.ingress.meter[5].committedBurstSize = 5kB